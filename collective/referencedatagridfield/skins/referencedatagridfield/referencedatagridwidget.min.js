if(void 0===dataGridFieldFunctions)var dataGridFieldFunctions={};!function(e){function t(t){e("#messageTitle").text(t),e("#message").show()}function n(t){e("ul#"+t+" :input").each(function(){var t,n;t=e(this).prop("value"),n=e("input[rel="+t+"]"),n.prop("disabled",!0),n.prop("checked",!0)})}function a(){e(document).data("atdgrb_history",[])}function i(t){var n=e(document).data("atdgrb_history");n.push(t),e(document).data("atdgrb_history",n)}function r(t,a,i){var r=e("[id^=atdgrb_] form#history select");t.load(a,function(){var t,a;e("[id^=atdgrb_] form#history select").append(i+r.html()),t=e("div#content").data("overlay"),a=t.getTrigger().attr("rel").substring(6),n(a)})}function d(t){var n,a,i;n=e(t.target),a=n.prop("value"),i=n.prop("default_value"),null!==i&&null!==a&&(i===a?n.prop("class","not-changed-title-field"):n.prop("class","changed-title-field"))}function l(t){e(t.target).prop("class","changed-title-field")}function o(e){var t=e.parentNode,n=null,a=null,i=null,r=null,d=null,l=null,p=null;return null===t?!1:(n=t.id.split("-"),a=n.pop(),0===a?!1:(i=n.pop(),r=t.cloneNode(!0),p=r.getElementsByTagName("input"),p.length>0&&(p[0].checked=t.getElementsByTagName("input")[0].checked),d=document.getElementById("ref-"+i+"-"+(a-1)),l=r.getElementsByTagName("a"),l[0].onclick=function(){o(this)},l[1].onclick=function(){u(this)},t.parentNode.insertBefore(r,d),t.parentNode.removeChild(t),r.id="ref-"+i+"-"+(a-1),void(d.id="ref-"+i+"-"+a)))}function u(t){var n=t.parentNode,a=null,i=null,r=null,d=null,l=null,p=null,c=null,s=null;return null===n?!1:(a=n.id.split("-"),i=parseInt(a.pop(),10),r=a.pop(),d=e("#"+r+" input"),i+1===d.length?!1:(l=n.cloneNode(!0),c=l.getElementsByTagName("input"),c.length>0&&(c[0].checked=n.getElementsByTagName("input")[0].checked),s=l.getElementsByTagName("a"),s[0].onclick=function(){o(this)},s[1].onclick=function(){u(this)},p=document.getElementById("ref-"+r+"-"+(i+1)),n.parentNode.insertBefore(l,p.nextSibling),n.parentNode.removeChild(n),l.id="ref-"+r+"-"+(i+1),void(p.id="ref-"+r+"-"+i)))}function p(t,n,a,i,r,p,c,s,f){var m,g,v,h,y=null,b=null,N=null,w=null,_=null,k=null,T=null,x=null;if(void 0!==r&&void 0!==c&&void 0!==f&&void 0!==p&&void 0!==s)e("#"+t,r).prop("value",n),m=e("#"+p,r),m.prop("value",c),m.addClass("not-changed-title-field"),m.prop("default_value",c),m.blur(d),m.focus(l),g=e("#"+s,r),g.prop("readonly",!1),g.prop("value",f),g.prop("readonly",!0),g.addClass("hidden-field");else if(0===i)e("#"+t).prop("value",n),e("#"+t+"_label").prop("value",a);else{for(b=e("#"+t+" input"),v=0;v<b.length;v+=1)if(b[v].value===n)return!1;N=document.getElementById(t),null===N&&(x=e("#archetypes-fieldname-"+t+" input + div"),x.length||(x=e("#archetypes-fieldname-value input + div")),x.after('<ul class="visualNoMarker" id="'+t+'"></ul>'),N=document.getElementById(t)),w=document.createElement("li"),y=document.createElement("label"),_=document.createElement("input"),_.type="checkbox",_.value=n,_.checked=!0,_.name=t+":list",y.appendChild(_),y.appendChild(document.createTextNode(" "+a)),w.appendChild(y),w.id="ref-"+t+"-"+b.length,h=e("input[name="+t+"-sortable]").prop("value"),"1"===h&&(k=document.createElement("a"),k.title="Move Up",k.innerHTML="&#x25b2;",k.onclick=function(){return o(this),!1},w.appendChild(k),T=document.createElement("a"),T.title="Move Down",T.innerHTML="&#x25bc;",T.onclick=function(){return u(this),!1},w.appendChild(T)),N.appendChild(w),console.log(N),console.log(w),_.checked=!0}}function c(d){e(function(){var l;e(".addreferencedatagrid",d).overlay({closeOnClick:!1,onBeforeLoad:function(){var t,n,i,r;t=e("div#content").data("overlay"),t&&t.close(),n=this.getOverlay().find(".overlaycontent"),l=this.getTrigger().parents("tr.datagridwidget-row"),i=this.getTrigger().prop("src"),r=i+" >*",n.data("srcfilter",r),e("div#content").data("overlay",this),a(),n.load(r)},onLoad:function(){var e=this.getTrigger().attr("rel").substring(6);n(e)}}),e(document).on("click","[id^=atdgrb_] a.browsesite",function(){var t,n,a,d,l;return t=e(this),n=t.prop("href"),a=t.parents(".overlaycontent"),d=n+" >*",i(a.data("srcfilter")),a.data("srcfilter",d),l='<option value="'+n+'">'+t.attr("rel")+"</option>",r(a,d,l),!1}),e(document).on("click","[id^=atdgrb_] input.insertreferencedatagrid",function(){var n,a,i,r,d,o,u,c,s,f,m;n=e(this),a=n.parents(".overlaycontent"),i=a.find("input[name=fieldName]").prop("value"),r=a.find("input[name=fieldTitleName]").prop("value"),d=a.find("input[name=fieldLinkName]").prop("value"),o=a.find("input[name=multiValued]").prop("value"),u=a.find("input[name=close_window]").prop("value"),c=n.parent().next("td").find("strong").html(),s=n.next("input").attr("rel"),f=n.attr("rel"),p(i,f,c,parseInt(o,10),l,r,c,d,s),"1"===u?(m=e("div#content").data("overlay"),m.close()):t(c),e(this).prop("disabled",!0)}),e(document).on("change","[id^=atdgrb_] form#history select[name=path]",function(){var t,n,a,i;return t=e(this),n=t.parents(".overlaycontent"),a=e("[id^=atdgrb_] form#history select[name=path] :selected",this).prop("value"),i=a+" >*",r(n,i,""),!1}),e(document).on("click","[id^=atdgrb_] div.listingBar a",function(){var t,n,a,i;return t=e(this),a=t.prop("href"),n=t.parents(".overlaycontent"),i=a+" >*",r(n,i,""),!1}),e(document).on("click","[id^=atdgrb_] form#search input[name=submit]",function(){var t,n,a,d,l,o,u,p,c,s,f,m,g;return t=e(this),n=t.parents("form").prop("action"),a=t.parents(".overlaycontent"),d=a.find("input[name=fieldName]").prop("value"),l=a.find("input[name=fieldTitleName]").prop("value"),o=a.find("input[name=fieldLinkName]").prop("value"),u=a.find("input[name=fieldRealName]").prop("value"),p=a.find("input[name=at_url]").prop("value"),c=a.find("input[name=searchValue]").prop("value"),s=a.find("input[name=multiValued]").prop("value"),f=a.find("input[name=close_window]").prop("value"),m="searchValue="+c+"&fieldRealName="+u+"&fieldName="+d+"&multiValued="+s+"&close_window="+f+"&at_url="+p+"&fieldTitleName="+l+"&fieldLinkName="+o,g=n+"?"+m+" >*",i(a.data("srcfilter")),a.data("srcfilter",g),r(a,g,""),!1})})}e(document).ready(function(){c(this)}),e.fn.prepRefPopup=function(){c(this)},dataGridFieldFunctions.addReferenceDataGridRow=function(t){this.addRow(t);var n=e("#datagridwidget-tbody-"+t+" tr.datagridwidget-row:last");e(n).prepRefPopup()},dataGridFieldFunctions.addReferenceDataGridRowAfter=function(t){this.addRowAfter(t);var n,a,i,r;n=e(t).parents("[id^=datagridwidget-tbody-]"),a=e("tr.datagridwidget-row",n),i=e(t).parents("tr.datagridwidget-row"),r=a[a.index(i)-1],e(r).prepRefPopup()},dataGridFieldFunctions.OriginalUpdateOrderIndex=dataGridFieldFunctions.updateOrderIndex,dataGridFieldFunctions.updateOrderIndex=function(t){var n,a,i,r,d,l,o,u,p,c;for(this.OriginalUpdateOrderIndex(t),n=e("tr.datagridwidget-row",t),u=0;u<n.length;u+=1)a=n[u],p=e("input[id^=orderindex__]",a),i=p.prop("value"),r=e("input.addreferencedatagrid",a),d=r.attr("rel"),l=d.lastIndexOf("_"),c=l>=0?d.substring(0,l):"#atrb",o=c+"_"+i,r.attr("rel",o),e("div[id^=atdgrb_]",a).prop("id",o.substring(1))}}(jQuery);